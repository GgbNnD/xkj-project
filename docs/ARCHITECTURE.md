# 远程声音控制系统架构设计文档

## 1. 系统概述

### 1.1 系统目标
实现一个完整的远程声音控制系统，能够：
- 采集并处理语音信号
- 通过噪声信道进行远程传输
- 识别语音命令
- 执行相应的控制动作

### 1.2 关键特性
- **信源压缩**：使用Huffman编码压缩信号
- **信道编码**：使用BCH编码进行纠错
- **调制传输**：使用BPSK调制通过AWGN信道
- **命令识别**：提取MFCC特征进行命令分类
- **控制执行**：PID控制器执行控制命令

## 2. 系统架构

### 2.1 11级处理流程

```
发送端 ━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 接收端
  ↓                              ↓
1. 采样                       10. 识别
  ↓                              ↓
2. 量化                       11. 执行
  ↓                              
3. 编码(Huffman)             
  ↓                              
4. 编码(BCH)                     
  ↓                              
5. 调制(BPSK)                    
  ↓                              
6. 传输(AWGN)                    
  ↓                              
7. 解调(BPSK)                    
  ↓                              
8. 解码(BCH)                     
  ↓                              
9. 解码(Huffman)                 
  ↓                              
  └→ 接收端接收
```

### 2.2 模块关系图

```
┌─────────────────────────────────────────────┐
│         RemoteVoiceControlSystem            │
│              (主控制器)                      │
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────┐  ┌──────────────────┐ │
│  │ SignalProcessing│  │SourceEncoding    │ │
│  │  (采样/量化)    │  │ (Huffman)        │ │
│  └────────┬────────┘  └────────┬─────────┘ │
│           │                    │           │
│  ┌────────▼────────┐  ┌───────▼──────────┐ │
│  │ChannelEncoding  │  │ Modulation       │ │
│  │  (BCH 15,7)     │  │ (BPSK + AWGN)   │ │
│  └────────┬────────┘  └────────┬─────────┘ │
│           │                    │           │
│  ┌────────▼─────────────────┬──┘           │
│  │ SpeechRecognition        │              │
│  │ (MFCC + Classification)  │              │
│  └────────┬─────────────────┘              │
│           │                                │
│  ┌────────▼────────────────────────────┐  │
│  │    ControlSystem (PID Motor)        │  │
│  └─────────────────────────────────────┘  │
└─────────────────────────────────────────────┘
```

## 3. 各模块详细设计

### 3.1 信号处理模块 (signal_processing.py)

#### 功能
- 音频采样
- 量化处理

#### 关键参数
| 参数 | 默认值 | 说明 |
|------|--------|------|
| fs | 44100 | 采样频率 (Hz) |
| quantization_bits | 8 | 量化位数 |

#### 量化过程
```
原始信号 → 归一化 → 划分电平 → 映射到量化值
     ↓
   MSE(量化误差)
```

#### 输出
- 采样信号：float数组
- 量化信号：float数组
- 比特序列：int数组 (0-255)

---

### 3.2 信源编码模块 (source_encoding.py)

#### 功能
- Huffman树构建
- 信号编码压缩
- 信号解码恢复

#### 算法原理
1. **频率统计**：统计符号出现频率
2. **树构建**：优先级队列合并最低频率节点
3. **编码生成**：DFS遍历生成编码表
4. **编码**：用编码表替换原始符号

#### 编码示例
```
符号: [0, 1, 2, 1, 0, 3]
频率: {0: 1/3, 1: 1/3, 2: 1/6, 3: 1/6}

Huffman树:
           (1.0)
          /     \
       (2/3)    (1/3)
       /   \       |
     (1/3)(1/3)    3
      /  \
     0    1

编码表:
  0 → "00"
  1 → "01"
  2 → "10"
  3 → "11"

编码: "00" "01" "10" "01" "00" "11"
```

#### 性能指标
| 指标 | 公式 | 说明 |
|------|------|------|
| 熵 (H) | $-\sum p_i \log_2(p_i)$ | 信息下界 |
| 平均码长 (L) | $\sum p_i l_i$ | 平均编码长 |
| 效率 (η) | H/L | 编码效率 |
| 压缩比 | 原始比特/编码比特 | 压缩效果 |

---

### 3.3 信道编码模块 (channel_encoding.py)

#### 功能
- BCH编码
- BCH解码
- 错误纠正

#### BCH(15,7)码参数
| 参数 | 值 | 说明 |
|------|-----|------|
| n | 15 | 码字长度 |
| k | 7 | 信息位长度 |
| m | 4 | GF(2^m)的m值 |
| t | 3 | 纠错能力(比特) |
| 生成多项式 | x^8+x^7+x^6+x^5+x^4+x^2+1 | - |

#### 编码过程
```
信息比特(7位) → 补零到14位 → 多项式除法 → 余数(校验位) → 码字(15位)

例如：
信息: [1 0 1 1 0 1 0]
码字: [1 0 1 1 0 1 0 | 校验位(8位)]
```

#### 解码过程
```
接收码字(15位) → 计算伴随式 → 错误位置检测 → 纠正 → 提取信息位(7位)

伴随式:
  S = 接收码字 mod 生成多项式
  如果 S = 0: 无错误
  如果 S ≠ 0: 有错误，根据S查表得错误位置
```

---

### 3.4 调制解调模块 (modulation.py)

#### BPSK调制
```
比特 → 符号映射 → AWGN信道 → 接收 → 硬判决 → 比特

映射规则：
  0 → +1
  1 → -1
```

#### 信噪比计算
$$SNR_{dB} = 10 \log_{10} \left(\frac{P_s}{P_n}\right)$$

其中：
- $P_s$ = 信号功率
- $P_n$ = 噪声功率

#### AWGN信道模型
```
接收信号 = 发送信号 + 高斯白噪声

y = s + n
其中 n ~ N(0, σ²)
```

#### 判决规则
```
硬判决 (Hard Decision):
  if y > 0: 判为 0
  if y ≤ 0: 判为 1

软判决 (Soft Decision):
  返回 y 本身作为置信度
```

---

### 3.5 语音识别模块 (speech_recognition.py)

#### MFCC特征提取
```
信号 → 帧化 → 窗函数 → FFT → 梅尔滤波组
       ↓
      DCT → MFCC系数
```

#### 特征参数
| 参数 | 默认值 | 说明 |
|------|--------|------|
| n_mfcc | 13 | MFCC系数数量 |
| frame_length | 2048 | 帧长(采样点) |
| hop_length | 512 | 帧间隔(采样点) |

#### 分类器
- **类型**：最近邻分类器 (简化实现)
- **距离度量**：欧几里得距离

#### 支持的命令
1. Forward（前进）
2. Backward（后退）
3. Stop（停止）
4. Rotate（旋转）

---

### 3.6 控制系统模块 (control_system.py)

#### PID控制器

**控制律**：
$$u(t) = K_p e(t) + K_i \int_0^t e(\tau) d\tau + K_d \frac{de(t)}{dt}$$

或离散形式：
$$u[n] = K_p e[n] + K_i \sum_{i=0}^{n} e[i] + K_d (e[n] - e[n-1])$$

#### 直流电动机模型

**动力学方程**：
$$J\frac{d\omega}{dt} = \tau - f\omega$$

其中：
- J = 转动惯量
- τ = 电磁力矩 = K_t * V (V为电压)
- f = 摩擦系数
- ω = 角速度

#### 性能指标
| 指标 | 说明 |
|------|------|
| 稳态误差 | 最终位置与目标位置的偏差 |
| 超调量 | 超过目标值的百分比 |
| 上升时间 | 从10%到90%的时间 |
| 沉定时间 | 进入稳态的时间 |

---

## 4. 数据流与信号变换

### 4.1 发送端数据流

```
Audio File (44.1kHz, 16-bit)
    ↓ (采样)
Sampled Signal (1D array, float64)
    ↓ (量化)
Quantized Signal (1D array, 0-255)
    ↓ (Huffman编码)
Encoded Bits (1D binary string)
    ↓ (BCH编码)
Channel Coded Bits (1D binary array)
    ↓ (BPSK调制)
Modulated Signal (1D array, float64)
    ↓ (AWGN)
Transmitted Signal (1D array, float64)
```

### 4.2 接收端数据流

```
Received Signal (noisy)
    ↓ (BPSK解调)
Demodulated Bits (0/1)
    ↓ (BCH解码)
Source Bits (recovered)
    ↓ (Huffman解码)
Reconstructed Symbols (0-255)
    ↓ (逆量化)
Reconstructed Signal (float64)
    ↓ (MFCC提取)
Feature Vector (13D)
    ↓ (分类)
Command Label (string)
    ↓ (执行)
Control Action
```

---

## 5. 性能分析

### 5.1 编码增益
```
无编码：BER = Q(√(2*SNR))
BCH(15,7)：可纠正3个错误，码率=7/15

编码增益 = 编码后所需的较低SNR - 未编码的SNR
        (保持相同的信息比特错误率)
```

### 5.2 压缩比
```
Huffman压缩比 = 原始比特数 / 编码后比特数

根据熵定理：
最优压缩比 ≤ H(源) (信息熵)
```

### 5.3 命令识别准确率
```
准确率 = 正确识别的命令数 / 总命令数

影响因素：
  - SNR值（越高越好）
  - 量化位数（越多越好）
  - 信道编码（可改进）
  - 特征提取（算法相关）
```

---

## 6. 参数优化建议

### 6.1 改进识别准确率

| 方案 | 影响 | 代价 |
|------|------|------|
| 增加SNR | ↑准确率 | 硬件成本 |
| 增加quantization_bits | ↑保真度 | ↑比特率 |
| 优化BCH参数 | ↑纠错能力 | ↓码率 |
| 改进特征提取 | ↑区分度 | 计算复杂度 |
| 优化PID参数 | ↑控制精度 | 调试时间 |

### 6.2 推荐配置

**高可靠性配置**：
```python
config = {
    'fs': 44100,
    'quantization_bits': 12,      # 高保真
    'channel_code_n': 31,         # 更强的编码
    'channel_code_k': 16,
    'snr_db': 20,                 # 良好的信号
    'num_commands': 8,
}
```

**低延迟配置**：
```python
config = {
    'fs': 16000,                  # 低采样率
    'quantization_bits': 4,       # 少量化
    'channel_code_n': 15,         # 标准编码
    'channel_code_k': 7,
    'snr_db': 10,
    'num_commands': 4,
}
```

---

## 7. 扩展方向

### 7.1 短期扩展
- [ ] 支持更多命令类型
- [ ] 集成真实语音识别模型
- [ ] GUI界面
- [ ] 实时处理

### 7.2 中期扩展
- [ ] 多用户支持
- [ ] MIMO通信
- [ ] 深度学习特征提取
- [ ] 自适应PID控制

### 7.3 长期扩展
- [ ] 多机器人协作
- [ ] 云边缘计算架构
- [ ] 强化学习控制
- [ ] 硬件实现(FPGA/DSP)

---

## 8. 参考文献

1. Shannon, C. E. (1948). "A Mathematical Theory of Communication"
2. 林鑫, 吴飞 (2006). "通信原理"
3. 胡广书 (2003). "数字信号处理：理论、算法与实现"
4. MATLAB Signal Processing Toolbox Documentation
5. IEEE 802.11n WLAN Specification (BCH, OFDM Reference)

---

## 9. 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| 1.0 | 2024-01-01 | 初始版本 |
| 1.1 | - | 规划中 |
| 2.0 | - | 深度学习版 |
